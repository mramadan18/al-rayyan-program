# دليل تطوير برنامج الريّان (Development Guide)

هذا الملف يوضح القواعد والأنماط البرمجية المعتمدة في المشروع لضمان سهولة الإضافة والتعديل مستقبلاً.

---

## 1. الهيكل التنظيمي للمشروع (Project Structure)

- **`main/`**: يحتوي على كود Electron (Logic الخلفية، الخدمات، والـ IPC).
  - `main/services/`: الخدمات المسؤولة عن النوافذ (Widgets) والجدولة.
  - `main/ipc/`: معالجات الاتصال بين الواجهة والخلفية.
- **`renderer/`**: يحتوي على كود React/Next.js (الواجهة الأمامية).
  - `renderer/pages/`: الصفحات العادية.
  - `renderer/pages/widgets/`: النوافذ المستقلة (الأذان، الدعاء، إلخ).
  - `renderer/components/common/`: المكونات العامة المشتركة.
- **`main/shared/`**: **أهم مجلد**. يحتوي على الثوابت (`constants.ts`) والأنواع (`types.ts`) المشتركة.
  - _ملاحظة:_ تم وضعه داخل `main` لضمان ترجمته برمجياً بشكل صحيح، ويتم استدعاؤه في الواجهة عبر الـ Alias التالي: `import { ... } from "shared/constants"`.

---

## 2. المسارات المختصرة (Path Aliases)

لتسهيل الاستدعاء، استخدمنا الأسماء المستعارة التالية:

- `@/*`: يشير إلى مجلد `renderer/*`.
- `shared/*`: يشير إلى مجلد `main/shared/*`.
  - _مثال:_ `import { IpcChannels } from "shared/constants";`

## 3. قواعد الاتصال (IPC Rules)

**القاعدة الذهبية:** لا تستخدم النصوص المباشرة (Strings) في قنوات الـ IPC.

- **الإجراء:** عند إضافة قناة اتصال جديدة، أضفها أولاً في `main/shared/constants.ts` داخل كائن `IpcChannels`.
- **لماذا؟** لتجنب الأخطاء الإملائية وضمان أن التغيير في مكان واحد سيحدث في كل التطبيق.

---

## 3. إضافة نافذة جديدة (Adding a New Widget)

إذا أردت إضافة نافذة منبثقة جديدة (مثل نافذة الأذكار):

1.  **الواجهة:** أنشئ ملف الصفحة في `renderer/pages/widgets/my-widget.tsx`.
2.  **الخلفية:** أنشئ خدمة في `main/services/my-widget-service.ts` لإدارة فتح وإغلاق النافذة.
3.  **الربط:** أضف قنوات الفتح والإغلاق في `IpcChannels`.
4.  **التسجيل:** سجل مستمعي الـ IPC في `main/ipc/index.ts`.

---

## 4. المكونات والستايل (Styling & Components)

- استخدم **Tailwind CSS** للتنسيق.
- المكونات الأساسية (Buttons, Inputs) موجودة في `renderer/components/ui/` (Shadcn UI).
- المكونات المشتركة بين الصفحات يجب أن توضع في `renderer/components/common/`.

---

## 5. قواعد تنظيف الكود (Cleaning Rules)

- حافظ على ملفات الـ `Context` (مثل `player-times.tsx`) نظيفة من أي منطق عرض (UI Logic).
- الوظائف المساعدة التي لا تعتمد على حالة المكون يجب أن توضع خارج المكون (Outside the component class/function) أو في ملف `utils`.
- دائمًا قم بإزالة الـ Listeners في الـ `useEffect` (Cleanup function) لمنع تسريب الذاكرة (Memory Leaks).

---

## 6. إجراءات إضافة ميزة جديدة (Workflow)

1.  **حدد الهدف:** هل الميزة تحتاج تواصل مع النظام (Main) أم واجهة فقط (Renderer)؟
2.  **حدث الثوابت:** أضف أي قنوات IPC جديدة في `main/shared/constants.ts`.
3.  **برمج الخلفية:** أضف الـ Logic المطلوب في مجلد `main/`.
4.  **برمج الواجهة:** أضف المكونات أو الصفحات في مجلد `renderer/`.
5.  **اختبر:** تأكد من أن الميزة تعمل في وضع التطوير (`npm run dev`).
